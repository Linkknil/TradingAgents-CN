# 网络搜索工具配置说明

## 功能概述

新增的网络搜索工具支持多种搜索引擎，可以通过配置开关控制是否启用。

## 配置参数

在 `app/config.py` 中新增了以下配置项：

```python
# 网络搜索工具相关配置
ENABLE_WEB_SEARCH = os.getenv("ENABLE_WEB_SEARCH", "false").strip().lower() in {"1", "true", "yes", "on"}
SEARCH_ENGINE = os.getenv("SEARCH_ENGINE", "duckduckgo")  # duckduckgo / serpapi / google
SERPAPI_API_KEY = os.getenv("SERPAPI_API_KEY")
GOOGLE_API_KEY = os.getenv("GOOGLE_API_KEY")
GOOGLE_CSE_ID = os.getenv("GOOGLE_CSE_ID")
SEARCH_MAX_RESULTS = int(os.getenv("SEARCH_MAX_RESULTS", "5"))
```

## 环境变量配置

### 基础配置
```bash
# 启用网络搜索工具
ENABLE_WEB_SEARCH=true

# 选择搜索引擎 (duckduckgo / serpapi / google)
SEARCH_ENGINE=duckduckgo

# 搜索结果数量限制
SEARCH_MAX_RESULTS=5
```

### DuckDuckGo 配置 (推荐，免费)
```bash
ENABLE_WEB_SEARCH=true
SEARCH_ENGINE=duckduckgo
# 无需API Key，直接可用
```

### SerpAPI 配置 (需要注册)
```bash
ENABLE_WEB_SEARCH=true
SEARCH_ENGINE=serpapi
SERPAPI_API_KEY=your_serpapi_key_here
```

### Google Custom Search 配置 (需要创建CSE)
```bash
ENABLE_WEB_SEARCH=true
SEARCH_ENGINE=google
GOOGLE_API_KEY=your_google_api_key_here
GOOGLE_CSE_ID=your_custom_search_engine_id_here
```

## 支持的搜索引擎

### 1. DuckDuckGo (默认)
- **优点**: 免费，无需API Key，隐私友好
- **缺点**: 结果相对简单
- **配置**: 无需额外配置

### 2. SerpAPI
- **优点**: 支持多种搜索引擎，结果丰富
- **缺点**: 需要付费API Key
- **注册**: https://serpapi.com/
- **配置**: 需要 `SERPAPI_API_KEY`

### 3. Google Custom Search
- **优点**: Google搜索结果，质量高
- **缺点**: 需要创建Custom Search Engine
- **配置**: 需要 `GOOGLE_API_KEY` 和 `GOOGLE_CSE_ID`

## 使用方法

### 1. 启用搜索工具
设置环境变量：
```bash
export ENABLE_WEB_SEARCH=true
export SEARCH_ENGINE=duckduckgo
```

### 2. 启动服务
```bash
python -m uvicorn app.main:app --reload
```

### 3. 使用搜索功能
在对话中，Agent会自动判断是否需要搜索网络信息，例如：
- "今天有什么新闻？"
- "最新的AI技术发展如何？"
- "搜索一下Python的最新版本"

### 4. 查看工具状态
访问 `/tools/info` 端点查看当前工具配置：
```bash
curl http://localhost:8000/tools/info
```

## 工具描述

网络搜索工具的描述信息：
```
网络搜索工具，用于搜索最新的网络信息。
输入: 搜索查询字符串
输出: 格式化的搜索结果，包含标题、摘要、链接和来源
使用场景: 当需要获取最新信息、实时数据或网络上的具体内容时使用此工具
```

## 注意事项

1. **网络搜索工具默认禁用**，需要手动启用
2. **DuckDuckGo** 是推荐的免费选项
3. **API Key** 请妥善保管，不要提交到代码仓库
4. **搜索结果** 会包含来源链接，便于验证信息
5. **错误处理** 已内置，网络问题不会影响其他功能
6. **模拟结果** 当真实API不可用时，会使用模拟结果作为备选

## 问题解决

### 搜索不返回结果
如果搜索工具不返回结果，可能的原因：
1. 网络连接问题
2. 搜索引擎API限制
3. 查询格式问题

**解决方案**：
- 检查网络连接
- 尝试不同的查询关键词
- 系统会自动使用模拟结果作为备选

### 搜索结果不准确
当前实现包含：
- 真实API搜索（优先）
- 模拟结果备选（当API失败时）

**改进建议**：
- 配置SerpAPI或Google Custom Search获得更准确的结果
- 根据具体需求调整搜索逻辑

## 扩展功能

未来可以扩展的功能：
- 支持更多搜索引擎
- 搜索结果缓存
- 搜索历史记录
- 搜索结果过滤和排序
- 多语言搜索支持
